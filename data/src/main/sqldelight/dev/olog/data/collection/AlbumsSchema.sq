CREATE VIEW albums_view AS
SELECT DISTINCT collection_id AS id, author_id, collection AS title, author, count(*) AS songs, directory, date_added
FROM songs_view
GROUP BY collection_id;

CREATE VIEW sorted_albums_view AS
SELECT albums_view.*
FROM albums_view
    LEFT JOIN sort ON TRUE
WHERE sort.table_name = 'albums' --see SortEntity
ORDER BY
-- title (album title)
CASE WHEN sort.column_name = 'collection' AND title = '<unknown>' THEN -1 END,
CASE WHEN sort.column_name = 'collection' AND sort.direction = 'asc' THEN lower(title) END COLLATE LOCALIZED ASC,
CASE WHEN sort.column_name = 'collection' AND sort.direction = 'desc' THEN lower(title) END COLLATE LOCALIZED DESC,
-- author
CASE WHEN sort.column_name = 'author' AND author = '<unknown>' THEN -1 END,
CASE WHEN sort.column_name = 'author' AND sort.direction = 'asc' THEN lower(author) END COLLATE LOCALIZED ASC,
CASE WHEN sort.column_name = 'author' AND sort.direction = 'desc' THEN lower(author) END COLLATE LOCALIZED DESC;

CREATE TABLE IF NOT EXISTS recently_played_albums (
    id INTEGER NOT NULL,
    date_played INTEGER NOT NULL,
    PRIMARY KEY(`id`)
);